
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Basic MANGO Tutorial &#8212; MANGO User Guide</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'src/MANGO_Demo_CEDAR_2024';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Markdown Files" href="markdown.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="MANGO User Guide - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="MANGO User Guide - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="markdown.html">Markdown Files</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Basic MANGO Tutorial</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/mangonetwork/tutorials/main?urlpath=lab/tree/./src/MANGO_Demo_CEDAR_2024.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/mangonetwork/tutorials/blob/main/./src/MANGO_Demo_CEDAR_2024.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/mangonetwork/tutorials" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mangonetwork/tutorials/issues/new?title=Issue%20on%20page%20%2Fsrc/MANGO_Demo_CEDAR_2024.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/src/MANGO_Demo_CEDAR_2024.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Basic MANGO Tutorial</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#helper-functions">Helper Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-information-about-the-dataset-to-be-worked-on">Setup information about the dataset to be worked on</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-data-and-load-in-the-hdf5-file">Download data and load in the HDF5 file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-the-loaded-dataset">Examine the loaded dataset</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manipulate-data">Manipulate data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#you-can-easily-create-masks-to-remove-low-elevation-obstructions">You can easily create masks to remove low-elevation obstructions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#you-can-plot-the-average-intensity-over-time-of-the-high-elevation-angle-pixels">You can plot the average intensity over time of the high-elevation angle pixels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#you-can-create-sub-images">You can create sub-images</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#you-can-temporally-filter-the-data">You can temporally filter the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-can-now-display-the-filtered-data-or-a-subset-in-various-coordinates">We can now display the filtered data, or a subset, in various coordinates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#can-load-another-site-and-plot-both-imagers-on-a-map">Can load another site and plot both imagers on a map</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fpi-data">FPI Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#can-load-in-fpi-data-and-plot-it">Can load in FPI data and plot it</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-some-helper-functions-needed-to-work-with-fpi-data">Define some helper functions needed to work with FPI data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-hdf5-file-downloaded-from-madrigal">Load the HDF5 file downloaded from Madrigal</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-look-directions-and-convert-from-line-of-sight-to-horizontal-winds">Define the look directions and convert from line-of-sight to horizontal winds</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-plot-of-the-horizontal-winds">Create a plot of the horizontal winds</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="basic-mango-tutorial">
<h1>Basic MANGO Tutorial<a class="headerlink" href="#basic-mango-tutorial" title="Link to this heading">#</a></h1>
<p>This notebook presents examples of how to download and perform basic plotting and manipulation of MANGO airglow and FPI data.</p>
<p>MANGO Website: <a class="reference external" href="https://www.mangonetwork.org/mango/v1/">https://www.mangonetwork.org/mango/v1/</a></p>
<p>Illinois Airglow Website: <a class="reference external" href="https://airglow.ece.illinois.edu">https://airglow.ece.illinois.edu</a></p>
<p>Scan to go to GitHub repo: <img src="https://go.ece.illinois.edu/qr/CEDAR2024MANGOtutorial.png?rn=0613T123559" width="200"></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">medfilt2d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urljoin</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</pre></div>
</div>
</div>
</div>
<section id="helper-functions">
<h2>Helper Functions<a class="headerlink" href="#helper-functions" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">download_hdf5_files</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download all .hdf5 files from a given URL and save them to a specified directory.</span>

<span class="sd">    :param url: The URL of the web page to scrape for .hdf5 files.</span>
<span class="sd">    :param save_dir: The directory where the files will be saved.</span>
<span class="sd">    :return: List of paths to the downloaded files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure the save directory exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>

    <span class="c1"># Get the HTML content of the page</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Raise an error for bad status codes</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

    <span class="c1"># Find all links to .hdf5 files</span>
    <span class="n">hdf5_links</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">href</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">href</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.hdf5&#39;</span><span class="p">):</span>
            <span class="n">hdf5_links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">href</span><span class="p">))</span>

    <span class="c1"># Download each .hdf5 file</span>
    <span class="n">downloaded_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">hdf5_url</span> <span class="ow">in</span> <span class="n">hdf5_links</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">hdf5_url</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        
        <span class="c1"># Download the file</span>
        <span class="n">hdf5_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hdf5_url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">hdf5_response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Raise an error for bad status codes</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">hdf5_response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        
        <span class="n">downloaded_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">downloaded_files</span>

<span class="k">def</span><span class="w"> </span><span class="nf">download_mango_L1</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">emission</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">asi_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download MANGO L1 data for a specific site, emission, and date.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    site (str): MANGO site abbreviation (e.g., &quot;low&quot;).</span>
<span class="sd">    emission (str): Emission type (&#39;green&#39; or &#39;red&#39;).</span>
<span class="sd">    date (datetime): Date of interest.</span>
<span class="sd">    asi_directory (str): Directory to download data to. Defaults to the current directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">    list: List of paths to the downloaded files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">downloaded_files</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">asi_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">asi_directory</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span>

    <span class="n">emission_path</span> <span class="o">=</span> <span class="s1">&#39;greenline&#39;</span> <span class="k">if</span> <span class="n">emission</span> <span class="o">==</span> <span class="s1">&#39;green&#39;</span> <span class="k">else</span> <span class="s1">&#39;redline&#39;</span>
    <span class="n">target_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">asi_directory</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%j&#39;</span><span class="p">))</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://data.mangonetwork.org/data/transport/mango/archive/</span><span class="si">{</span><span class="n">site</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">emission_path</span><span class="si">}</span><span class="s1">/level1/</span><span class="si">{</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%j&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">/&#39;</span>
    
    <span class="n">downloaded_files</span> <span class="o">=</span> <span class="n">download_hdf5_files</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">target_directory</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">target_directory</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">downloaded_files</span>

<span class="k">def</span><span class="w"> </span><span class="nf">load_hdf5_to_xarray</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load data from an HDF5 file into an xarray Dataset and apply a median filter to image data.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    file_path (str): Path to the MANGO HDF5 file.</span>
<span class="sd">    kernel_size (int): Size of the 2D median filter to apply to each image. Defaults to 7.</span>

<span class="sd">    Returns:</span>
<span class="sd">    xarray.Dataset: Dataset containing the loaded data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_arrays</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">hdf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdf</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                <span class="n">data_arrays</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">hdf</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">...</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>

    <span class="c1"># Convert Unix times to datetime objects</span>
    <span class="n">unix_times_start</span> <span class="o">=</span> <span class="n">data_arrays</span><span class="p">[</span><span class="s1">&#39;UnixTime&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">start_times</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">unix_times_start</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">unix_times_stop</span> <span class="o">=</span> <span class="n">data_arrays</span><span class="p">[</span><span class="s1">&#39;UnixTime&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">stop_times</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">unix_times_stop</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Calculate integration time and ensure it&#39;s a float</span>
    <span class="n">integration_time_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop_times</span> <span class="o">-</span> <span class="n">start_times</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="n">integration_time_values</span> <span class="o">=</span> <span class="n">integration_time_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1"># Ensure &#39;time&#39; is numpy.datetime64</span>
    <span class="n">start_times_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>

    <span class="c1"># Rename the dimensions of the ImageData</span>
    <span class="n">image_data</span> <span class="o">=</span> <span class="n">data_arrays</span><span class="p">[</span><span class="s1">&#39;ImageData&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;dim_0&#39;</span><span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;dim_1&#39;</span><span class="p">:</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;dim_2&#39;</span><span class="p">:</span> <span class="s1">&#39;east&#39;</span><span class="p">})</span>
    <span class="n">image_data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Pixel values of image at each time step&#39;</span>

    <span class="c1"># Process other variables</span>
    <span class="n">azimuth</span> <span class="o">=</span> <span class="n">data_arrays</span><span class="p">[</span><span class="s1">&#39;Azimuth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;dim_0&#39;</span><span class="p">:</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;dim_1&#39;</span><span class="p">:</span> <span class="s1">&#39;east&#39;</span><span class="p">})</span>
    <span class="n">azimuth</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Degrees&#39;</span>
    <span class="n">azimuth</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Azimuth of each pixel&#39;</span>
    <span class="n">elevation</span> <span class="o">=</span> <span class="n">data_arrays</span><span class="p">[</span><span class="s1">&#39;Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;dim_0&#39;</span><span class="p">:</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;dim_1&#39;</span><span class="p">:</span> <span class="s1">&#39;east&#39;</span><span class="p">})</span>
    <span class="n">elevation</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Degrees&#39;</span>
    <span class="n">elevation</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Elevation of each pixel&#39;</span>
    <span class="n">latitude</span> <span class="o">=</span> <span class="n">data_arrays</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;dim_0&#39;</span><span class="p">:</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;dim_1&#39;</span><span class="p">:</span> <span class="s1">&#39;east&#39;</span><span class="p">})</span>
    <span class="n">latitude</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Degrees N&#39;</span>
    <span class="n">latitude</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Geodetic latitude of each pixel&#39;</span>
    <span class="n">longitude</span> <span class="o">=</span> <span class="n">data_arrays</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;dim_0&#39;</span><span class="p">:</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;dim_1&#39;</span><span class="p">:</span> <span class="s1">&#39;east&#39;</span><span class="p">})</span>
    <span class="n">longitude</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Degrees E&#39;</span>
    <span class="n">longitude</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Geodetic longitude of each pixel&#39;</span>
    <span class="n">CCDTemperature</span> <span class="o">=</span> <span class="n">data_arrays</span><span class="p">[</span><span class="s1">&#39;CCDTemperature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;dim_0&#39;</span><span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">})</span>
    <span class="n">CCDTemperature</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Celsius&#39;</span>
    <span class="n">CCDTemperature</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Temperature of CCD&#39;</span>

    <span class="n">north_array</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data_arrays</span><span class="p">[</span><span class="s1">&#39;PixelCoordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">))</span>
    <span class="n">north_array</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;km&#39;</span>
    <span class="n">north_array</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Distance in north direction from site at airglow layer&#39;</span>
    <span class="n">east_array</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data_arrays</span><span class="p">[</span><span class="s1">&#39;PixelCoordinates&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">))</span>
    <span class="n">east_array</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;km&#39;</span>
    <span class="n">east_array</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Distance in east direction from site at airglow layer&#39;</span>

    <span class="c1"># Apply median filter to each image</span>
    <span class="n">im_ds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">image_data</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">medfilt2d</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;east&#39;</span><span class="p">))</span>
        <span class="n">im_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

    <span class="n">combined</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">im_ds</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">combined</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Pixel values of image at each time step after median filter&#39;</span>

    <span class="n">integration_time</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">integration_time_values</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">start_times_np</span><span class="p">},</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">))</span>
    <span class="n">integration_time</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
    <span class="n">integration_time</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Integration time of the image&#39;</span>

    <span class="c1"># Create xarray Dataset</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span>
        <span class="s1">&#39;integration_time&#39;</span><span class="p">:</span> <span class="n">integration_time</span><span class="p">,</span>
        <span class="s1">&#39;ImageData&#39;</span><span class="p">:</span> <span class="n">combined</span><span class="p">,</span>
        <span class="s1">&#39;Azimuth&#39;</span><span class="p">:</span> <span class="n">azimuth</span><span class="p">,</span>
        <span class="s1">&#39;Elevation&#39;</span><span class="p">:</span> <span class="n">elevation</span><span class="p">,</span>
        <span class="s1">&#39;Latitude&#39;</span><span class="p">:</span> <span class="n">latitude</span><span class="p">,</span>
        <span class="s1">&#39;Longitude&#39;</span><span class="p">:</span> <span class="n">longitude</span><span class="p">,</span>
        <span class="s1">&#39;CCDTemperature&#39;</span><span class="p">:</span> <span class="n">CCDTemperature</span><span class="p">,</span>
        <span class="s1">&#39;east&#39;</span><span class="p">:</span> <span class="n">east_array</span><span class="p">,</span>
        <span class="s1">&#39;north&#39;</span><span class="p">:</span> <span class="n">north_array</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">ds</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="setup-information-about-the-dataset-to-be-worked-on">
<h2>Setup information about the dataset to be worked on<a class="headerlink" href="#setup-information-about-the-dataset-to-be-worked-on" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">site</span> <span class="o">=</span> <span class="s1">&#39;blo&#39;</span>
<span class="n">emission</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>
<span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
<span class="c1">#asi_directory = &#39;/home/airglow/scratch_data/CEDAR_test/MANGO_Data&#39;</span>
<span class="n">asi_directory</span> <span class="o">=</span> <span class="s1">&#39;MANGO_Data&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="download-data-and-load-in-the-hdf5-file">
<h3>Download data and load in the HDF5 file<a class="headerlink" href="#download-data-and-load-in-the-hdf5-file" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">downloaded_data</span> <span class="o">=</span> <span class="n">download_mango_L1</span><span class="p">(</span><span class="n">site</span><span class="p">,</span><span class="n">emission</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">asi_directory</span><span class="o">=</span><span class="n">asi_directory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>https://data.mangonetwork.org/data/transport/mango/archive/blo/greenline/level1/2023/131/
MANGO_Data/blo/2023/131
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ds is our dataset</span>
<span class="n">ds</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds</span><span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_hdf5_to_xarray</span><span class="p">(</span><span class="n">downloaded_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="examine-the-loaded-dataset">
<h3>Examine the loaded dataset<a class="headerlink" href="#examine-the-loaded-dataset" title="Link to this heading">#</a></h3>
<p>The dataset is an xarray data structure containing information from the HDF5 file and has the following format:</p>
<p>Coordinates:</p>
<ul class="simple">
<li><p>time (datetime64) - time stamps of each image in the data set</p></li>
<li><p>east (float) - east km distance from the center of the image. This is a uniform step.</p></li>
<li><p>north (float) - north km distance from the center of the image. This is a uniform step.</p></li>
</ul>
<p>Data Variable:</p>
<ul class="simple">
<li><p>integration_time (float) - integration time for each image in sec (dim: time)</p></li>
<li><p>ImageData (int) - intensity values in the image (dims: time, north, east)
the image data has had a 7x7 median filter applied to remove stars</p></li>
<li><p>Azimuth (float) - azimuth for each pixel, in deg (dims: north, east)</p></li>
<li><p>Elevation (float) - elevation for each pixel, in deg (dims: north, east)</p></li>
<li><p>Latitude (float) - latitude for each pixel, in deg N (dims: north, east)</p></li>
<li><p>Longitude (float) - longtitude for each pixel, in deg E (dims: north, east)</p></li>
<li><p>CCDTemperature (float) - CCD temperature, in C (dim: time)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(
    --jp-content-font-color0,
    var(--pst-color-text-base rgba(0, 0, 0, 1))
  );
  --xr-font-color2: var(
    --jp-content-font-color2,
    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))
  );
  --xr-font-color3: var(
    --jp-content-font-color3,
    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))
  );
  --xr-border-color: var(
    --jp-border-color2,
    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))
  );
  --xr-disabled-color: var(
    --jp-layout-color3,
    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))
  );
  --xr-background-color: var(
    --jp-layout-color0,
    var(--pst-color-on-background, white)
  );
  --xr-background-color-row-even: var(
    --jp-layout-color1,
    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))
  );
  --xr-background-color-row-odd: var(
    --jp-layout-color2,
    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))
  );
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: var(
    --jp-content-font-color0,
    var(--pst-color-text-base, rgba(255, 255, 255, 1))
  );
  --xr-font-color2: var(
    --jp-content-font-color2,
    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))
  );
  --xr-font-color3: var(
    --jp-content-font-color3,
    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))
  );
  --xr-border-color: var(
    --jp-border-color2,
    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))
  );
  --xr-disabled-color: var(
    --jp-layout-color3,
    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))
  );
  --xr-background-color: var(
    --jp-layout-color0,
    var(--pst-color-on-background, #111111)
  );
  --xr-background-color-row-even: var(
    --jp-layout-color1,
    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))
  );
  --xr-background-color-row-odd: var(
    --jp-layout-color2,
    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))
  );
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
  border: 2px solid transparent !important;
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0) !important;
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  border-color: var(--xr-background-color-row-odd);
  margin-bottom: 0;
  padding-top: 2px;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
  border-color: var(--xr-background-color-row-even);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  border-top: 2px dotted var(--xr-background-color);
  padding-bottom: 20px !important;
  padding-top: 10px !important;
}

.xr-var-attrs-in + label,
.xr-var-data-in + label,
.xr-index-data-in + label {
  padding: 0 1px;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-data > pre,
.xr-index-data > pre,
.xr-var-data > table > tbody > tr {
  background-color: transparent !important;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}

.xr-var-attrs-in:checked + label > .xr-icon-file-text2,
.xr-var-data-in:checked + label > .xr-icon-database,
.xr-index-data-in:checked + label > .xr-icon-database {
  color: var(--xr-font-color0);
  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));
  stroke-width: 0.8px;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 51MB
Dimensions:           (time: 173, north: 500, east: 500)
Coordinates:
  * time              (time) datetime64[ns] 1kB 2023-05-11T04:30:00 ... 2023-...
  * east              (east) float64 4kB -324.3 -323.0 -321.7 ... 323.0 324.3
  * north             (north) float64 4kB -324.3 -323.0 -321.7 ... 323.0 324.3
Data variables:
    integration_time  (time) float64 1kB 110.0 110.0 110.0 ... 110.0 110.0 110.0
    ImageData         (time, north, east) uint8 43MB 0 0 0 0 0 0 ... 0 0 0 0 0 0
    Azimuth           (north, east) float64 2MB -135.0 -135.1 ... 44.88 45.0
    Elevation         (north, east) float64 2MB 9.749 9.776 ... 9.776 9.749
    Latitude          (north, east) float64 2MB 39.0 39.0 39.0 ... 44.74 44.74
    Longitude         (north, east) float64 2MB -115.1 -115.1 ... -107.4 -107.4
    CCDTemperature    (time) float64 1kB -4.95 -4.71 -5.35 ... -4.95 -5.27 -4.95</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-bf955366-b189-490e-8ab3-34420a468ef1' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-bf955366-b189-490e-8ab3-34420a468ef1' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 173</li><li><span class='xr-has-index'>north</span>: 500</li><li><span class='xr-has-index'>east</span>: 500</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-7b574d34-aa37-4b6b-8bbf-3252cd7d2b81' class='xr-section-summary-in' type='checkbox'  checked><label for='section-7b574d34-aa37-4b6b-8bbf-3252cd7d2b81' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2023-05-11T04:30:00 ... 2023-05-...</div><input id='attrs-8e1b3856-84eb-43ec-b8a5-f3a8c0663b13' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8e1b3856-84eb-43ec-b8a5-f3a8c0663b13' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-13b3755e-bae5-4ca9-b8c3-2cb51038a7a3' class='xr-var-data-in' type='checkbox'><label for='data-13b3755e-bae5-4ca9-b8c3-2cb51038a7a3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2023-05-11T04:30:00.000000000&#x27;, &#x27;2023-05-11T04:32:00.000000000&#x27;,
       &#x27;2023-05-11T04:34:00.000000000&#x27;, &#x27;2023-05-11T04:36:00.000000000&#x27;,
       &#x27;2023-05-11T04:38:00.000000000&#x27;, &#x27;2023-05-11T04:40:00.000000000&#x27;,
       &#x27;2023-05-11T04:42:00.000000000&#x27;, &#x27;2023-05-11T04:44:00.000000000&#x27;,
       &#x27;2023-05-11T04:46:00.000000000&#x27;, &#x27;2023-05-11T04:48:00.000000000&#x27;,
       &#x27;2023-05-11T04:50:00.000000000&#x27;, &#x27;2023-05-11T04:52:00.000000000&#x27;,
       &#x27;2023-05-11T04:54:00.000000000&#x27;, &#x27;2023-05-11T04:56:00.000000000&#x27;,
       &#x27;2023-05-11T04:58:00.000000000&#x27;, &#x27;2023-05-11T05:00:00.000000000&#x27;,
       &#x27;2023-05-11T05:02:00.000000000&#x27;, &#x27;2023-05-11T05:04:00.000000000&#x27;,
       &#x27;2023-05-11T05:06:00.000000000&#x27;, &#x27;2023-05-11T05:08:00.000000000&#x27;,
       &#x27;2023-05-11T05:10:00.000000000&#x27;, &#x27;2023-05-11T05:12:00.000000000&#x27;,
       &#x27;2023-05-11T05:14:00.000000000&#x27;, &#x27;2023-05-11T05:16:00.000000000&#x27;,
       &#x27;2023-05-11T05:18:00.000000000&#x27;, &#x27;2023-05-11T05:20:00.000000000&#x27;,
       &#x27;2023-05-11T05:22:00.000000000&#x27;, &#x27;2023-05-11T05:24:00.000000000&#x27;,
       &#x27;2023-05-11T05:26:00.000000000&#x27;, &#x27;2023-05-11T05:28:00.000000000&#x27;,
       &#x27;2023-05-11T05:30:00.000000000&#x27;, &#x27;2023-05-11T05:32:00.000000000&#x27;,
       &#x27;2023-05-11T05:34:00.000000000&#x27;, &#x27;2023-05-11T05:36:00.000000000&#x27;,
       &#x27;2023-05-11T05:38:00.000000000&#x27;, &#x27;2023-05-11T05:40:00.000000000&#x27;,
       &#x27;2023-05-11T05:42:00.000000000&#x27;, &#x27;2023-05-11T05:44:00.000000000&#x27;,
       &#x27;2023-05-11T05:46:00.000000000&#x27;, &#x27;2023-05-11T05:48:00.000000000&#x27;,
       &#x27;2023-05-11T05:50:00.000000000&#x27;, &#x27;2023-05-11T05:52:00.000000000&#x27;,
       &#x27;2023-05-11T05:54:00.000000000&#x27;, &#x27;2023-05-11T05:56:00.000000000&#x27;,
       &#x27;2023-05-11T05:58:00.000000000&#x27;, &#x27;2023-05-11T06:00:00.000000000&#x27;,
       &#x27;2023-05-11T06:02:00.000000000&#x27;, &#x27;2023-05-11T06:04:00.000000000&#x27;,
       &#x27;2023-05-11T06:06:00.000000000&#x27;, &#x27;2023-05-11T06:08:00.000000000&#x27;,
       &#x27;2023-05-11T06:10:00.000000000&#x27;, &#x27;2023-05-11T06:12:00.000000000&#x27;,
       &#x27;2023-05-11T06:14:00.000000000&#x27;, &#x27;2023-05-11T06:16:00.000000000&#x27;,
       &#x27;2023-05-11T06:18:00.000000000&#x27;, &#x27;2023-05-11T06:20:00.000000000&#x27;,
       &#x27;2023-05-11T06:22:00.000000000&#x27;, &#x27;2023-05-11T06:24:00.000000000&#x27;,
       &#x27;2023-05-11T06:26:00.000000000&#x27;, &#x27;2023-05-11T06:28:00.000000000&#x27;,
       &#x27;2023-05-11T06:30:00.000000000&#x27;, &#x27;2023-05-11T06:32:00.000000000&#x27;,
       &#x27;2023-05-11T06:34:00.000000000&#x27;, &#x27;2023-05-11T06:36:00.000000000&#x27;,
       &#x27;2023-05-11T06:38:00.000000000&#x27;, &#x27;2023-05-11T06:40:00.000000000&#x27;,
       &#x27;2023-05-11T06:42:00.000000000&#x27;, &#x27;2023-05-11T06:44:00.000000000&#x27;,
       &#x27;2023-05-11T06:46:00.000000000&#x27;, &#x27;2023-05-11T06:48:00.000000000&#x27;,
       &#x27;2023-05-11T06:50:00.000000000&#x27;, &#x27;2023-05-11T06:52:00.000000000&#x27;,
       &#x27;2023-05-11T06:54:00.000000000&#x27;, &#x27;2023-05-11T06:56:00.000000000&#x27;,
       &#x27;2023-05-11T06:58:00.000000000&#x27;, &#x27;2023-05-11T07:00:00.000000000&#x27;,
       &#x27;2023-05-11T07:02:00.000000000&#x27;, &#x27;2023-05-11T07:04:00.000000000&#x27;,
       &#x27;2023-05-11T07:06:00.000000000&#x27;, &#x27;2023-05-11T07:08:00.000000000&#x27;,
       &#x27;2023-05-11T07:10:00.000000000&#x27;, &#x27;2023-05-11T07:12:00.000000000&#x27;,
       &#x27;2023-05-11T07:14:00.000000000&#x27;, &#x27;2023-05-11T07:16:00.000000000&#x27;,
       &#x27;2023-05-11T07:18:00.000000000&#x27;, &#x27;2023-05-11T07:20:00.000000000&#x27;,
       &#x27;2023-05-11T07:22:00.000000000&#x27;, &#x27;2023-05-11T07:24:00.000000000&#x27;,
       &#x27;2023-05-11T07:26:00.000000000&#x27;, &#x27;2023-05-11T07:28:00.000000000&#x27;,
       &#x27;2023-05-11T07:30:00.000000000&#x27;, &#x27;2023-05-11T07:32:00.000000000&#x27;,
       &#x27;2023-05-11T07:34:00.000000000&#x27;, &#x27;2023-05-11T07:36:00.000000000&#x27;,
       &#x27;2023-05-11T07:38:00.000000000&#x27;, &#x27;2023-05-11T07:40:00.000000000&#x27;,
       &#x27;2023-05-11T07:42:00.000000000&#x27;, &#x27;2023-05-11T07:44:00.000000000&#x27;,
       &#x27;2023-05-11T07:46:00.000000000&#x27;, &#x27;2023-05-11T07:48:00.000000000&#x27;,
       &#x27;2023-05-11T07:50:00.000000000&#x27;, &#x27;2023-05-11T07:52:00.000000000&#x27;,
       &#x27;2023-05-11T07:54:00.000000000&#x27;, &#x27;2023-05-11T07:56:00.000000000&#x27;,
       &#x27;2023-05-11T07:58:00.000000000&#x27;, &#x27;2023-05-11T08:00:00.000000000&#x27;,
       &#x27;2023-05-11T08:02:00.000000000&#x27;, &#x27;2023-05-11T08:04:00.000000000&#x27;,
       &#x27;2023-05-11T08:06:00.000000000&#x27;, &#x27;2023-05-11T08:08:00.000000000&#x27;,
       &#x27;2023-05-11T08:10:00.000000000&#x27;, &#x27;2023-05-11T08:12:00.000000000&#x27;,
       &#x27;2023-05-11T08:14:00.000000000&#x27;, &#x27;2023-05-11T08:16:00.000000000&#x27;,
       &#x27;2023-05-11T08:18:00.000000000&#x27;, &#x27;2023-05-11T08:20:00.000000000&#x27;,
       &#x27;2023-05-11T08:22:00.000000000&#x27;, &#x27;2023-05-11T08:24:00.000000000&#x27;,
       &#x27;2023-05-11T08:26:00.000000000&#x27;, &#x27;2023-05-11T08:28:00.000000000&#x27;,
       &#x27;2023-05-11T08:30:00.000000000&#x27;, &#x27;2023-05-11T08:32:00.000000000&#x27;,
       &#x27;2023-05-11T08:34:00.000000000&#x27;, &#x27;2023-05-11T08:36:00.000000000&#x27;,
       &#x27;2023-05-11T08:38:00.000000000&#x27;, &#x27;2023-05-11T08:40:00.000000000&#x27;,
       &#x27;2023-05-11T08:42:00.000000000&#x27;, &#x27;2023-05-11T08:44:00.000000000&#x27;,
       &#x27;2023-05-11T08:46:00.000000000&#x27;, &#x27;2023-05-11T08:48:00.000000000&#x27;,
       &#x27;2023-05-11T08:50:00.000000000&#x27;, &#x27;2023-05-11T08:52:00.000000000&#x27;,
       &#x27;2023-05-11T08:54:00.000000000&#x27;, &#x27;2023-05-11T08:56:00.000000000&#x27;,
       &#x27;2023-05-11T08:58:00.000000000&#x27;, &#x27;2023-05-11T09:00:00.000000000&#x27;,
       &#x27;2023-05-11T09:02:00.000000000&#x27;, &#x27;2023-05-11T09:04:00.000000000&#x27;,
       &#x27;2023-05-11T09:06:00.000000000&#x27;, &#x27;2023-05-11T09:08:00.000000000&#x27;,
       &#x27;2023-05-11T09:10:00.000000000&#x27;, &#x27;2023-05-11T09:12:00.000000000&#x27;,
       &#x27;2023-05-11T09:14:00.000000000&#x27;, &#x27;2023-05-11T09:16:00.000000000&#x27;,
       &#x27;2023-05-11T09:18:00.000000000&#x27;, &#x27;2023-05-11T09:20:00.000000000&#x27;,
       &#x27;2023-05-11T09:22:00.000000000&#x27;, &#x27;2023-05-11T09:24:00.000000000&#x27;,
       &#x27;2023-05-11T09:26:00.000000000&#x27;, &#x27;2023-05-11T09:28:00.000000000&#x27;,
       &#x27;2023-05-11T09:30:00.000000000&#x27;, &#x27;2023-05-11T09:32:00.000000000&#x27;,
       &#x27;2023-05-11T09:34:00.000000000&#x27;, &#x27;2023-05-11T09:36:00.000000000&#x27;,
       &#x27;2023-05-11T09:38:00.000000000&#x27;, &#x27;2023-05-11T09:40:00.000000000&#x27;,
       &#x27;2023-05-11T09:42:00.000000000&#x27;, &#x27;2023-05-11T09:44:00.000000000&#x27;,
       &#x27;2023-05-11T09:46:00.000000000&#x27;, &#x27;2023-05-11T09:48:00.000000000&#x27;,
       &#x27;2023-05-11T09:50:00.000000000&#x27;, &#x27;2023-05-11T09:52:00.000000000&#x27;,
       &#x27;2023-05-11T09:54:00.000000000&#x27;, &#x27;2023-05-11T09:56:00.000000000&#x27;,
       &#x27;2023-05-11T09:58:00.000000000&#x27;, &#x27;2023-05-11T10:00:00.000000000&#x27;,
       &#x27;2023-05-11T10:02:00.000000000&#x27;, &#x27;2023-05-11T10:04:00.000000000&#x27;,
       &#x27;2023-05-11T10:06:00.000000000&#x27;, &#x27;2023-05-11T10:08:00.000000000&#x27;,
       &#x27;2023-05-11T10:10:00.000000000&#x27;, &#x27;2023-05-11T10:12:00.000000000&#x27;,
       &#x27;2023-05-11T10:14:00.000000000&#x27;], dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>east</span></div><div class='xr-var-dims'>(east)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-324.3 -323.0 ... 323.0 324.3</div><input id='attrs-8d284f6c-c184-4016-a791-9efaff114462' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-8d284f6c-c184-4016-a791-9efaff114462' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dedf015a-9609-4526-bc68-25c79f7dd7a6' class='xr-var-data-in' type='checkbox'><label for='data-dedf015a-9609-4526-bc68-25c79f7dd7a6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>km</dd><dt><span>description :</span></dt><dd>Distance in east direction from site at airglow layer</dd></dl></div><div class='xr-var-data'><pre>array([-324.330309, -323.030388, -321.730467, ...,  321.730467,  323.030388,
        324.330309], shape=(500,))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>north</span></div><div class='xr-var-dims'>(north)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-324.3 -323.0 ... 323.0 324.3</div><input id='attrs-bdc29463-6ad9-4b60-90fd-c25ebade612c' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-bdc29463-6ad9-4b60-90fd-c25ebade612c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-599c0295-3210-436e-a721-81b68f1c8a40' class='xr-var-data-in' type='checkbox'><label for='data-599c0295-3210-436e-a721-81b68f1c8a40' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>km</dd><dt><span>description :</span></dt><dd>Distance in north direction from site at airglow layer</dd></dl></div><div class='xr-var-data'><pre>array([-324.330309, -323.030388, -321.730467, ...,  321.730467,  323.030388,
        324.330309], shape=(500,))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-f235bae1-43f5-44c8-8302-22eeb6c0e33e' class='xr-section-summary-in' type='checkbox'  checked><label for='section-f235bae1-43f5-44c8-8302-22eeb6c0e33e' class='xr-section-summary' >Data variables: <span>(7)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>integration_time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>110.0 110.0 110.0 ... 110.0 110.0</div><input id='attrs-2d323be9-4720-44e0-a7d9-e8efe869ec6a' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-2d323be9-4720-44e0-a7d9-e8efe869ec6a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4c8141d1-a3dd-428b-aa0c-75022b3f3281' class='xr-var-data-in' type='checkbox'><label for='data-4c8141d1-a3dd-428b-aa0c-75022b3f3281' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>s</dd><dt><span>description :</span></dt><dd>Integration time of the image</dd></dl></div><div class='xr-var-data'><pre>array([110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110., 110.,
       110., 110., 110., 110., 110.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>ImageData</span></div><div class='xr-var-dims'>(time, north, east)</div><div class='xr-var-dtype'>uint8</div><div class='xr-var-preview xr-preview'>0 0 0 0 0 0 0 0 ... 0 0 0 0 0 0 0 0</div><input id='attrs-81318efc-b2e9-4174-877a-2681331d7760' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-81318efc-b2e9-4174-877a-2681331d7760' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-27775c5b-aaab-4919-a1be-ee80f4e7f824' class='xr-var-data-in' type='checkbox'><label for='data-27775c5b-aaab-4919-a1be-ee80f4e7f824' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>description :</span></dt><dd>Pixel values of image at each time step after median filter</dd></dl></div><div class='xr-var-data'><pre>array([[[0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        ...,
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0]],

       [[0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        ...,
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0]],

       [[0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        ...,
...
        ...,
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0]],

       [[0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        ...,
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0]],

       [[0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        ...,
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0]]], shape=(173, 500, 500), dtype=uint8)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Azimuth</span></div><div class='xr-var-dims'>(north, east)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-135.0 -135.1 -135.2 ... 44.88 45.0</div><input id='attrs-ccd7e975-b6a9-4eca-b85d-fb54adcd2e7d' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ccd7e975-b6a9-4eca-b85d-fb54adcd2e7d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3365ba3c-6f02-4b26-9c2a-9d3f2332c8d6' class='xr-var-data-in' type='checkbox'><label for='data-3365ba3c-6f02-4b26-9c2a-9d3f2332c8d6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>Degrees</dd><dt><span>description :</span></dt><dd>Azimuth of each pixel</dd></dl></div><div class='xr-var-data'><pre>array([[-135.        , -135.11505161, -135.23056527, ...,  135.23056527,
         135.11505161,  135.        ],
       [-134.88494839, -135.        , -135.11551553, ...,  135.11551553,
         135.        ,  134.88494839],
       [-134.76943473, -134.88448447, -135.        , ...,  135.        ,
         134.88448447,  134.76943473],
       ...,
       [ -45.23056527,  -45.11551553,  -45.        , ...,   45.        ,
          45.11551553,   45.23056527],
       [ -45.11505161,  -45.        ,  -44.88448447, ...,   44.88448447,
          45.        ,   45.11505161],
       [ -45.        ,  -44.88494839,  -44.76943473, ...,   44.76943473,
          44.88494839,   45.        ]], shape=(500, 500))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Elevation</span></div><div class='xr-var-dims'>(north, east)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>9.749 9.776 9.803 ... 9.776 9.749</div><input id='attrs-e950c3d1-e351-4263-9c0e-6ed3c89f37ad' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-e950c3d1-e351-4263-9c0e-6ed3c89f37ad' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-aec815d7-6c23-4db5-82cb-9d2c0259d939' class='xr-var-data-in' type='checkbox'><label for='data-aec815d7-6c23-4db5-82cb-9d2c0259d939' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>Degrees</dd><dt><span>description :</span></dt><dd>Elevation of each pixel</dd></dl></div><div class='xr-var-data'><pre>array([[9.74883267, 9.77589072, 9.80298241, ..., 9.80298241, 9.77589072,
        9.74883267],
       [9.77589072, 9.80309194, 9.83032757, ..., 9.83032757, 9.80309194,
        9.77589072],
       [9.80298241, 9.83032757, 9.85770796, ..., 9.85770796, 9.83032757,
        9.80298241],
       ...,
       [9.80298241, 9.83032757, 9.85770796, ..., 9.85770796, 9.83032757,
        9.80298241],
       [9.77589072, 9.80309194, 9.83032757, ..., 9.83032757, 9.80309194,
        9.77589072],
       [9.74883267, 9.77589072, 9.80298241, ..., 9.80298241, 9.77589072,
        9.74883267]], shape=(500, 500))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Latitude</span></div><div class='xr-var-dims'>(north, east)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>39.0 39.0 39.0 ... 44.74 44.74</div><input id='attrs-d739cfc4-fa2d-46dd-9ec8-fb6390be2ff4' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d739cfc4-fa2d-46dd-9ec8-fb6390be2ff4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-328d8d6c-f687-40f6-b376-8510d31ad27f' class='xr-var-data-in' type='checkbox'><label for='data-328d8d6c-f687-40f6-b376-8510d31ad27f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>Degrees N</dd><dt><span>description :</span></dt><dd>Geodetic latitude of each pixel</dd></dl></div><div class='xr-var-data'><pre>array([[38.99886684, 38.99935302, 38.99983726, ..., 38.99983726,
        38.99935302, 38.99886684],
       [39.01037081, 39.01085711, 39.01134147, ..., 39.01134147,
        39.01085711, 39.01037081],
       [39.02187478, 39.0223612 , 39.02284567, ..., 39.02284567,
        39.0223612 , 39.02187478],
       ...,
       [44.71544642, 44.71599824, 44.71654785, ..., 44.71654785,
        44.71599824, 44.71544642],
       [44.72694656, 44.72749852, 44.72804827, ..., 44.72804827,
        44.72749852, 44.72694656],
       [44.73844668, 44.73899879, 44.73954869, ..., 44.73954869,
        44.73899879, 44.73844668]], shape=(500, 500))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Longitude</span></div><div class='xr-var-dims'>(north, east)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-115.1 -115.1 ... -107.4 -107.4</div><input id='attrs-14f3c68c-05dd-44ee-87b2-681f68c9eb02' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-14f3c68c-05dd-44ee-87b2-681f68c9eb02' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4fe7321d-5e9a-4c40-9d56-6292f8017b5b' class='xr-var-data-in' type='checkbox'><label for='data-4fe7321d-5e9a-4c40-9d56-6292f8017b5b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>Degrees E</dd><dt><span>description :</span></dt><dd>Geodetic longitude of each pixel</dd></dl></div><div class='xr-var-data'><pre>array([[-115.11833148, -115.10352928, -115.08872687, ..., -107.75303949,
        -107.73823708, -107.72343488],
       [-115.11894606, -115.10414141, -115.08933655, ..., -107.75242981,
        -107.73762495, -107.7228203 ],
       [-115.11956094, -115.10475384, -115.08994653, ..., -107.75181983,
        -107.73701252, -107.72220542],
       ...,
       [-115.46517596, -115.44899157, -115.43280688, ..., -107.40895948,
        -107.39277479, -107.3765904 ],
       [-115.46596772, -115.44978018, -115.43359234, ..., -107.40817402,
        -107.39198618, -107.37579863],
       [-115.46675991, -115.45056922, -115.43437822, ..., -107.40738814,
        -107.39119714, -107.37500645]], shape=(500, 500))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>CCDTemperature</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-4.95 -4.71 -5.35 ... -5.27 -4.95</div><input id='attrs-5e5e7838-5077-427d-9bb8-e78877400c39' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-5e5e7838-5077-427d-9bb8-e78877400c39' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c4d54caf-cc95-47df-89af-8c6638dd7e48' class='xr-var-data-in' type='checkbox'><label for='data-c4d54caf-cc95-47df-89af-8c6638dd7e48' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>Celsius</dd><dt><span>description :</span></dt><dd>Temperature of CCD</dd></dl></div><div class='xr-var-data'><pre>array([-4.94999981, -4.71000004, -5.3499999 , -4.55000019, -5.19000006,
       -5.42999983, -4.94999981, -5.3499999 , -4.55000019, -5.42999983,
       -4.63000011, -5.3499999 , -4.94999981, -4.94999981, -4.94999981,
       -4.94999981, -5.42999983, -4.71000004, -5.42999983, -4.55000019,
       -5.19000006, -5.19000006, -5.19000006, -5.26999998, -4.63000011,
       -5.3499999 , -4.63000011, -5.42999983, -4.71000004, -4.94999981,
       -4.94999981, -4.55000019, -5.26999998, -4.63000011, -4.94999981,
       -4.94999981, -4.71000004, -5.3499999 , -4.55000019, -4.94999981,
       -5.26999998, -4.94999981, -5.42999983, -4.94999981, -5.42999983,
       -4.94999981, -5.42999983, -4.71000004, -4.94999981, -4.94999981,
       -4.71000004, -4.94999981, -4.63000011, -5.26999998, -4.63000011,
       -4.94999981, -5.3499999 , -4.94999981, -4.94999981, -4.63000011,
       -4.94999981, -4.94999981, -4.94999981, -4.94999981, -5.3499999 ,
       -4.94999981, -5.3499999 , -4.71000004, -5.26999998, -4.63000011,
       -4.94999981, -4.63000011, -5.26999998, -4.63000011, -5.26999998,
       -4.94999981, -5.3499999 , -4.63000011, -5.42999983, -4.71000004,
       -5.3499999 , -4.63000011, -5.19000006, -4.94999981, -5.3499999 ,
       -4.71000004, -5.42999983, -4.71000004, -5.42999983, -4.94999981,
       -5.3499999 , -4.94999981, -5.26999998, -4.63000011, -5.19000006,
       -4.71000004, -5.3499999 , -4.94999981, -4.94999981, -4.94999981,
       -4.71000004, -5.26999998, -4.71000004, -5.26999998, -4.94999981,
       -5.42999983, -4.94999981, -4.94999981, -4.94999981, -4.94999981,
       -4.94999981, -4.94999981, -5.3499999 , -4.94999981, -4.71000004,
       -4.94999981, -4.71000004, -4.94999981, -5.42999983, -4.94999981,
       -5.19000006, -5.26999998, -5.19000006, -4.94999981, -4.94999981,
       -4.94999981, -5.3499999 , -4.94999981, -5.26999998, -4.94999981,
       -5.19000006, -4.71000004, -5.19000006, -4.71000004, -5.3499999 ,
       -4.71000004, -5.26999998, -4.94999981, -5.3499999 , -4.94999981,
       -5.3499999 , -4.63000011, -4.94999981, -4.71000004, -5.26999998,
       -4.71000004, -5.3499999 , -4.94999981, -5.3499999 , -4.94999981,
       -5.3499999 , -4.71000004, -5.3499999 , -4.94999981, -5.26999998,
       -4.94999981, -5.26999998, -4.71000004, -5.19000006, -4.94999981,
       -5.26999998, -4.94999981, -4.94999981, -4.94999981, -4.94999981,
       -5.26999998, -4.94999981, -5.42999983, -4.71000004, -4.94999981,
       -4.94999981, -5.26999998, -4.94999981])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-737b4039-8900-4f69-a2dc-4e5b5f3afc1a' class='xr-section-summary-in' type='checkbox'  ><label for='section-737b4039-8900-4f69-a2dc-4e5b5f3afc1a' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-3db4f5b5-2d72-4f19-8261-5d9a038ccd2b' class='xr-index-data-in' type='checkbox'/><label for='index-3db4f5b5-2d72-4f19-8261-5d9a038ccd2b' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;2023-05-11 04:30:00&#x27;, &#x27;2023-05-11 04:32:00&#x27;,
               &#x27;2023-05-11 04:34:00&#x27;, &#x27;2023-05-11 04:36:00&#x27;,
               &#x27;2023-05-11 04:38:00&#x27;, &#x27;2023-05-11 04:40:00&#x27;,
               &#x27;2023-05-11 04:42:00&#x27;, &#x27;2023-05-11 04:44:00&#x27;,
               &#x27;2023-05-11 04:46:00&#x27;, &#x27;2023-05-11 04:48:00&#x27;,
               ...
               &#x27;2023-05-11 09:56:00&#x27;, &#x27;2023-05-11 09:58:00&#x27;,
               &#x27;2023-05-11 10:00:00&#x27;, &#x27;2023-05-11 10:02:00&#x27;,
               &#x27;2023-05-11 10:04:00&#x27;, &#x27;2023-05-11 10:06:00&#x27;,
               &#x27;2023-05-11 10:08:00&#x27;, &#x27;2023-05-11 10:10:00&#x27;,
               &#x27;2023-05-11 10:12:00&#x27;, &#x27;2023-05-11 10:14:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=173, freq=None))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>east</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-d262ac31-c1de-4f87-96cf-4dba9d0e08f4' class='xr-index-data-in' type='checkbox'/><label for='index-d262ac31-c1de-4f87-96cf-4dba9d0e08f4' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ -324.3303088721998,  -323.0303877945557,  -321.7304667169116,
        -320.4305456392675, -319.13062456162345, -317.83070348397933,
        -316.5307824063353, -315.23086132869116,  -313.9309402510471,
         -312.631019173403,
       ...
        312.63101917340293,   313.9309402510471,  315.23086132869116,
         316.5307824063352,   317.8307034839793,  319.13062456162345,
         320.4305456392675,  321.73046671691156,   323.0303877945556,
         324.3303088721998],
      dtype=&#x27;float64&#x27;, name=&#x27;east&#x27;, length=500))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>north</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-1bb9899e-961f-437d-94fd-2dac42fa0058' class='xr-index-data-in' type='checkbox'/><label for='index-1bb9899e-961f-437d-94fd-2dac42fa0058' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ -324.3303088721998,  -323.0303877945557,  -321.7304667169116,
        -320.4305456392675, -319.13062456162345, -317.83070348397933,
        -316.5307824063353, -315.23086132869116,  -313.9309402510471,
         -312.631019173403,
       ...
        312.63101917340293,   313.9309402510471,  315.23086132869116,
         316.5307824063352,   317.8307034839793,  319.13062456162345,
         320.4305456392675,  321.73046671691156,   323.0303877945556,
         324.3303088721998],
      dtype=&#x27;float64&#x27;, name=&#x27;north&#x27;, length=500))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-d7fdf8c6-4ea5-41e2-a4d8-52a059771f1c' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-d7fdf8c6-4ea5-41e2-a4d8-52a059771f1c' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
</section>
</section>
<section id="manipulate-data">
<h2>Manipulate data<a class="headerlink" href="#manipulate-data" title="Link to this heading">#</a></h2>
<p>The xarray format allows easy manipulation and plotting of the data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ImageData</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f5f8567a780&gt;
</pre></div>
</div>
<img alt="../_images/a371667ad82ee6663084d8518c353e56013fbe9bbf1ea788b1e52803d753091a.png" src="../_images/a371667ad82ee6663084d8518c353e56013fbe9bbf1ea788b1e52803d753091a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Longitude</span><span class="p">,</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Latitude</span><span class="p">,</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ImageData</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f5f82300980&gt;
</pre></div>
</div>
<img alt="../_images/472ec3464ade46baf8f6c964ae9845481889efec626d4d8585187b4472b6c58b.png" src="../_images/472ec3464ade46baf8f6c964ae9845481889efec626d4d8585187b4472b6c58b.png" />
</div>
</div>
<section id="you-can-easily-create-masks-to-remove-low-elevation-obstructions">
<h3>You can easily create masks to remove low-elevation obstructions<a class="headerlink" href="#you-can-easily-create-masks-to-remove-low-elevation-obstructions" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Elevation</span> <span class="o">&gt;</span> <span class="mf">20.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Longitude</span><span class="p">,</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Latitude</span><span class="p">,</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ImageData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f5f85128f20&gt;
</pre></div>
</div>
<img alt="../_images/65397612f0559efd66b52db292649eb67aeb3f914738c84fd336c0b3d9afa9fb.png" src="../_images/65397612f0559efd66b52db292649eb67aeb3f914738c84fd336c0b3d9afa9fb.png" />
</div>
</div>
</section>
<section id="you-can-plot-the-average-intensity-over-time-of-the-high-elevation-angle-pixels">
<h3>You can plot the average intensity over time of the high-elevation angle pixels<a class="headerlink" href="#you-can-plot-the-average-intensity-over-time-of-the-high-elevation-angle-pixels" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ze_mask</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Elevation</span> <span class="o">&gt;</span> <span class="mi">85</span>
<span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ImageData</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ze_mask</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">,</span><span class="s1">&#39;north&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f5f851a6420&gt;]
</pre></div>
</div>
<img alt="../_images/290a44b4121f94ab98618ba5c67dcd86c68db9664d67a769ffef1b2048deb91b.png" src="../_images/290a44b4121f94ab98618ba5c67dcd86c68db9664d67a769ffef1b2048deb91b.png" />
</div>
</div>
</section>
<section id="you-can-create-sub-images">
<h3>You can create sub-images<a class="headerlink" href="#you-can-create-sub-images" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find the square inscribed in the circle. The side of the square that can be inscribed</span>
<span class="c1"># in a circle of radius r is sqrt(2)*r. Find the smallest dimension in the east and north</span>
<span class="c1"># arrays and use that as the radius. May need to tweak this for imagers that have obstructions</span>
<span class="c1"># above el_cutoff</span>
<span class="n">min_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">north</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">min_r</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">subset</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">east</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">,</span><span class="n">r</span><span class="p">),</span> <span class="n">north</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">,</span><span class="n">r</span><span class="p">))</span>
<span class="n">subset</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">ImageData</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f5f822f5940&gt;
</pre></div>
</div>
<img alt="../_images/ab18295d301201ec5b5d7b34397cf785bfdb0da0c34936678b47f8d3e3904004.png" src="../_images/ab18295d301201ec5b5d7b34397cf785bfdb0da0c34936678b47f8d3e3904004.png" />
</div>
</div>
</section>
<section id="you-can-temporally-filter-the-data">
<h3>You can temporally filter the data<a class="headerlink" href="#you-can-temporally-filter-the-data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">signal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>

<span class="c1"># Calculate the sampling period (in seconds)</span>
<span class="n">sampling_periods</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

<span class="c1"># Desired filter parameters</span>
<span class="n">ntaps</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">Tlo</span> <span class="o">=</span> <span class="mi">2</span>   <span class="c1"># minutes</span>
<span class="n">Thi</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># minutes</span>

<span class="c1"># Design the filter</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">sampling_periods</span>
<span class="n">cutofflo</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">Thi</span><span class="o">*</span><span class="mf">60.</span><span class="p">)</span>
<span class="n">cutoffhi</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">Tlo</span><span class="o">*</span><span class="mf">60.</span><span class="p">)</span>
<span class="n">fir_coeff</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">firwin</span><span class="p">(</span><span class="n">ntaps</span><span class="p">,</span> <span class="p">[</span><span class="n">cutofflo</span><span class="p">],</span> <span class="n">pass_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

<span class="c1"># Function to apply the filter to a subset of the data</span>
<span class="k">def</span><span class="w"> </span><span class="nf">apply_filter</span><span class="p">(</span><span class="n">sub_data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">fir_coeff</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">sub_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Split the data for parallel processing</span>
<span class="k">def</span><span class="w"> </span><span class="nf">parallel_filter</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="c1"># Reshape data to apply filter independently on each (north, east) pair</span>
    <span class="n">reshaped_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Use multiprocessing to filter data in parallel</span>
    <span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">apply_filter</span><span class="p">,</span> <span class="p">[</span><span class="n">reshaped_data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">reshaped_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
    
    <span class="c1"># Combine the filtered data back into the original shape</span>
    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="c1"># Create a new xarray Dataset with the filtered data</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;FilteredImageData&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;east&#39;</span><span class="p">),</span> <span class="n">filtered_data</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">ds</span>

<span class="c1"># # IF USING MULTIPROCESSING</span>
<span class="c1"># # Apply the parallel filter</span>
<span class="c1"># ds[&#39;blo&#39;] = parallel_filter(ds[&#39;blo&#39;], &#39;ImageData&#39;)</span>

<span class="c1"># IF NOT USING MULTIPROCESSING</span>
<span class="c1"># Apply the FIR filter using filtfilt to avoid time offset</span>
<span class="n">filtered_data</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">fir_coeff</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ImageData</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">][</span><span class="s1">&#39;FilteredImageData&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;north&#39;</span><span class="p">,</span><span class="s1">&#39;east&#39;</span><span class="p">),</span> <span class="n">filtered_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="we-can-now-display-the-filtered-data-or-a-subset-in-various-coordinates">
<h3>We can now display the filtered data, or a subset, in various coordinates<a class="headerlink" href="#we-can-now-display-the-filtered-data-or-a-subset-in-various-coordinates" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">FilteredImageData</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f5f822cb8f0&gt;
</pre></div>
</div>
<img alt="../_images/3ce42d60cda78da39758b918366fcb02117ce5c7a35fc166979476bfc0f26b8f.png" src="../_images/3ce42d60cda78da39758b918366fcb02117ce5c7a35fc166979476bfc0f26b8f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subset</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;blo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">east</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">,</span><span class="n">r</span><span class="p">),</span> <span class="n">north</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">,</span><span class="n">r</span><span class="p">))</span>
<span class="n">subset</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">FilteredImageData</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f5f822f7170&gt;
</pre></div>
</div>
<img alt="../_images/0336dff8c45c91cfa1fe200a905212b8602217815a4f9ed785952fc62ea5bdfe.png" src="../_images/0336dff8c45c91cfa1fe200a905212b8602217815a4f9ed785952fc62ea5bdfe.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">widgets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">interact</span>

<span class="n">background_subtract</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">FilteredImageData</span> <span class="o">-</span> <span class="n">subset</span><span class="o">.</span><span class="n">FilteredImageData</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">,</span><span class="s1">&#39;north&#39;</span><span class="p">])</span>

<span class="c1"># Function to update the plot</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_plot</span><span class="p">(</span><span class="n">time_index</span><span class="p">):</span>
    <span class="n">background_subtract</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time_index</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">15</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bwr&#39;</span><span class="p">)</span>

<span class="c1"># Create an interactive widget</span>
<span class="n">interact</span><span class="p">(</span><span class="n">update_plot</span><span class="p">,</span> <span class="n">time_index</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "fca3c9d9fdec485e89749c4d6c974724"}</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.update_plot(time_index)&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="can-load-another-site-and-plot-both-imagers-on-a-map">
<h3>Can load another site and plot both imagers on a map<a class="headerlink" href="#can-load-another-site-and-plot-both-imagers-on-a-map" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sites</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="s1">&#39;cvo&#39;</span><span class="p">,</span> <span class="s1">&#39;cfs&#39;</span><span class="p">]</span>
<span class="n">downloaded_data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>
    <span class="n">downloaded_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">download_mango_L1</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">emission</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">asi_directory</span><span class="o">=</span><span class="n">asi_directory</span><span class="p">))</span>

<span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sites</span><span class="p">,</span><span class="n">downloaded_data</span><span class="p">):</span>
    <span class="n">ds</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_hdf5_to_xarray</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>https://data.mangonetwork.org/data/transport/mango/archive/low/greenline/level1/2023/131/
MANGO_Data/low/2023/131
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>https://data.mangonetwork.org/data/transport/mango/archive/cvo/greenline/level1/2023/131/
MANGO_Data/cvo/2023/131
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>https://data.mangonetwork.org/data/transport/mango/archive/cfs/greenline/level1/2023/131/
MANGO_Data/cfs/2023/131
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">line</span> <span class="mi">8</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">downloaded_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">download_mango_L1</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">emission</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">asi_directory</span><span class="o">=</span><span class="n">asi_directory</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sites</span><span class="p">,</span><span class="n">downloaded_data</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">8</span>     <span class="n">ds</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_hdf5_to_xarray</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nn">Cell In[2], line 134,</span> in <span class="ni">load_hdf5_to_xarray</span><span class="nt">(file_path, kernel_size)</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span> <span class="n">im_ds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">image_data</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">134</span>     <span class="n">temp</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">medfilt2d</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;east&#39;</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">135</span>     <span class="n">im_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span> <span class="n">combined</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">im_ds</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/envs/buildjupyterbook/lib/python3.12/site-packages/scipy/signal/_signaltools.py:2094,</span> in <span class="ni">medfilt2d</span><span class="nt">(input, kernel_size)</span>
<span class="g g-Whitespace">   </span><span class="mi">2091</span>     <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2092</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Each element of kernel_size should be odd.&quot;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2094</span> <span class="n">result_np</span> <span class="o">=</span> <span class="n">_sigtools</span><span class="o">.</span><span class="n">_medfilt2d</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2095</span> <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">result_np</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">cartopy</span><span class="w"> </span><span class="kn">import</span> <span class="n">crs</span><span class="p">,</span><span class="n">feature</span>

<span class="c1"># We will plot images closest to a specific time</span>
<span class="n">target_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2023-05-11T05:34:00.000000000&#39;</span><span class="p">)</span>

<span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">124</span><span class="p">,</span><span class="o">-</span><span class="mi">102</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">48</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">axes00</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">crs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">extent</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">:])))</span>
<span class="n">axes00</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
<span class="n">axes00</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">STATES</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">nearest_time</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">target_time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">time_difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">nearest_time</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">target_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">time_difference</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">target_time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        
        <span class="n">latitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Latitude</span>
        <span class="n">longitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Longitude</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Elevation</span> <span class="o">&gt;</span> <span class="mf">20.</span>

        <span class="n">pc</span> <span class="o">=</span> <span class="n">axes00</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span><span class="n">latitude</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">ImageData</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">),</span><span class="n">transform</span><span class="o">=</span><span class="n">crs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="n">axes00</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">target_time</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;2023-05-11 05:34:00&#39;)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/e30737/venvs/py313/lib/python3.13/site-packages/cartopy/io/__init__.py:241: DownloadWarning: Downloading: https://naturalearth.s3.amazonaws.com/50m_cultural/ne_50m_admin_1_states_provinces_lakes.zip
  warnings.warn(f&#39;Downloading: {url}&#39;, DownloadWarning)
/Users/e30737/venvs/py313/lib/python3.13/site-packages/cartopy/io/__init__.py:241: DownloadWarning: Downloading: https://naturalearth.s3.amazonaws.com/50m_physical/ne_50m_coastline.zip
  warnings.warn(f&#39;Downloading: {url}&#39;, DownloadWarning)
</pre></div>
</div>
<img alt="../_images/0d885f753c41dd72126f142bb109fd176688c0bccae3c83476c6d97075f8d91c.png" src="../_images/0d885f753c41dd72126f142bb109fd176688c0bccae3c83476c6d97075f8d91c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s filter the data and plot it</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="c1"># ds[s] = parallel_filter(ds[s], &#39;ImageData&#39;)</span>
    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">fir_coeff</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">ds</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">ImageData</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ds</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;FilteredImageData&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;north&#39;</span><span class="p">,</span><span class="s1">&#39;east&#39;</span><span class="p">),</span> <span class="n">filtered_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">cartopy</span><span class="w"> </span><span class="kn">import</span> <span class="n">crs</span><span class="p">,</span><span class="n">feature</span>

<span class="c1"># We will plot images closest to a specific time</span>
<span class="n">target_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2023-05-11T05:34:00.000000000&#39;</span><span class="p">)</span>

<span class="c1"># Define the map extent (region to be plotted)</span>
<span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">124</span><span class="p">,</span><span class="o">-</span><span class="mi">102</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">48</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">axes00</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">crs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">extent</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">:])))</span>
<span class="n">axes00</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
<span class="n">axes00</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">STATES</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Plot the background subtracted image that is closest to the target time (within 10 minutes)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">nearest_time</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">target_time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">time_difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">nearest_time</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">target_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">time_difference</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">target_time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        
        <span class="n">latitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Latitude</span>
        <span class="n">longitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Longitude</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Elevation</span> <span class="o">&gt;</span> <span class="mf">20.</span>

        <span class="n">background_subtract</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">FilteredImageData</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">FilteredImageData</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">,</span><span class="s1">&#39;north&#39;</span><span class="p">])</span>

        <span class="n">pc</span> <span class="o">=</span> <span class="n">axes00</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span><span class="n">latitude</span><span class="p">,</span><span class="n">background_subtract</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">),</span><span class="n">transform</span><span class="o">=</span><span class="n">crs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="n">axes00</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">target_time</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;2023-05-11 05:34:00&#39;)
</pre></div>
</div>
<img alt="../_images/2ec8a87050ffa61a9f6b527ebb7c7b1b6a8c5d97cd9bb681219c18540a4923a6.png" src="../_images/2ec8a87050ffa61a9f6b527ebb7c7b1b6a8c5d97cd9bb681219c18540a4923a6.png" />
</div>
</div>
</section>
</section>
<section id="fpi-data">
<h2>FPI Data<a class="headerlink" href="#fpi-data" title="Link to this heading">#</a></h2>
<section id="can-load-in-fpi-data-and-plot-it">
<h3>Can load in FPI data and plot it<a class="headerlink" href="#can-load-in-fpi-data-and-plot-it" title="Link to this heading">#</a></h3>
<p>Used madrigalWeb to download relevant FPI data from LOW. the <a class="reference external" href="http://globalDownload.py">globalDownload.py</a> function can be obtained by:</p>
<p><code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">http://cedar.openmadrigal.org/static/distributionFiles/madrigalWeb-3.2.3.tar.gz</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">globalDownload.py</span> <span class="pre">--verbose</span> <span class="pre">--url=http://cedar.openmadrigal.org</span> <span class="pre">--outputDir=/tmp</span> <span class="pre">--user_fullname=&quot;Jonathan+Makela&quot;</span> <span class="pre">--user_email=jmakela&#64;illinois.edu</span> <span class="pre">--user_affiliation=&quot;University+of+Illinois&quot;</span> <span class="pre">--format=&quot;hdf5&quot;</span> <span class="pre">--startDate=&quot;05/10/2023&quot;</span> <span class="pre">--endDate=&quot;05/12/2023&quot;</span> <span class="pre">--inst=5555</span></code></p>
<p>Alternatively, the following code block uses the <a class="reference external" href="https://pypi.org/project/madrigalWeb/">madrigalWeb</a> python package to download the same data.  Note that it may take several minutes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">madrigalWeb.madrigalWeb</span>

<span class="c1">#constants</span>
<span class="n">madrigalUrl</span> <span class="o">=</span> <span class="s1">&#39;http://cedar.openmadrigal.org&#39;</span>

<span class="n">user_fullname</span> <span class="o">=</span> <span class="s1">&#39;Jonathan Makela&#39;</span>
<span class="n">user_email</span> <span class="o">=</span> <span class="s1">&#39;jmakela@illinois.edu&#39;</span>
<span class="n">user_affiliation</span> <span class="o">=</span> <span class="s1">&#39;University of Illinois&#39;</span>

<span class="c1"># create the main object to get all needed info from Madrigal</span>
<span class="n">madrigalObj</span> <span class="o">=</span> <span class="n">madrigalWeb</span><span class="o">.</span><span class="n">madrigalWeb</span><span class="o">.</span><span class="n">MadrigalData</span><span class="p">(</span><span class="n">madrigalUrl</span><span class="p">)</span>

<span class="c1"># Lowel FPI</span>
<span class="n">code</span> <span class="o">=</span> <span class="mi">5555</span>

<span class="n">expList</span> <span class="o">=</span> <span class="n">madrigalObj</span><span class="o">.</span><span class="n">getExperiments</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="mi">2023</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2023</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">expList</span><span class="p">:</span>

    <span class="n">fileList</span> <span class="o">=</span> <span class="n">madrigalObj</span><span class="o">.</span><span class="n">getExperimentFiles</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">fileList</span><span class="p">:</span>

        <span class="n">outFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">asi_directory</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span>
        <span class="n">madrigalObj</span><span class="o">.</span><span class="n">downloadFile</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">outFile</span><span class="p">,</span> <span class="n">user_fullname</span><span class="p">,</span> <span class="n">user_email</span><span class="p">,</span> <span class="n">user_affiliation</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;hdf5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MANGO_Data/minime11_low_20230509.cedar.034.hdf5
MANGO_Data/minime11_low_20230509_xg.cedar.043.hdf5
MANGO_Data/minime11_low_20230510.cedar.034.hdf5
MANGO_Data/minime11_low_20230510_xg.cedar.042.hdf5
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-some-helper-functions-needed-to-work-with-fpi-data">
<h3>Define some helper functions needed to work with FPI data<a class="headerlink" href="#define-some-helper-functions-needed-to-work-with-fpi-data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mangofpi_to_xarray</span><span class="p">(</span><span class="n">data_array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a structured array of MangoFPI data read from Madrigal HDF5 into an xarray Dataset.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    data_array (np.recarray): Input structured array containing MangoFPI data with time and measurement fields.</span>

<span class="sd">    Returns:</span>
<span class="sd">    xarray.Dataset: The converted xarray Dataset with appropriately named variables and attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract time components and create time dimension</span>
    <span class="n">time_dimension</span> <span class="o">=</span> <span class="n">create_time_dimension</span><span class="p">(</span><span class="n">data_array</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">data_array</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">data_array</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">],</span>
                                           <span class="n">data_array</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">data_array</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">],</span> <span class="n">data_array</span><span class="p">[</span><span class="s1">&#39;sec&#39;</span><span class="p">])</span>

    <span class="c1"># Create xarray Dataset</span>
    <span class="n">data_vars</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">,),</span> <span class="n">data_array</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> 
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;sec&#39;</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="n">xr_dataset</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">data_vars</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">time_dimension</span><span class="p">})</span>

    <span class="c1"># Set attributes for each variable</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">elm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Degrees&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">elm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Elevation angle (0=horizontal;90=vertical)&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">azm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Degrees&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">azm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Mean azimuth angle (0=geographic north;90=east)&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">vnu</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;m/s&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">vnu</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Line of sight neutral velocity (positive = away)&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">dvnu</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;m/s&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">dvnu</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Error in line of sight neutral velocity&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">tn</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">tn</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Neutral atmosphere temperature (Tn)&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">dtn</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">dtn</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Error in neutral atmosphere temperature (Tn)&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">gdalt</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;km&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">gdalt</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Geodetic altitude (height)&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">rlel</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">rlel</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Log10 relative (uncalibrated) emission&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">cloudind</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">cloudind</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Ambient temperature - sky temperature. &lt; -25 implies clear&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">temp_err</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">temp_err</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Temperature flag: 0=ok; 1=caution; 2=likely bad&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">wind_err</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">wind_err</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Wind flag: 0=ok; 1=caution; 2=likely bad&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">doppl_ref</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">doppl_ref</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Doppler calibration: 1=laser; 0=no vertical winds&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">fit_sigma</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;m/s&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">fit_sigma</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Wind uncertainty - least squares fit to sky fringes&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">cal_sigma</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;m/s&#39;</span>
    <span class="n">xr_dataset</span><span class="o">.</span><span class="n">cal_sigma</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Wind uncertainty - fluctuation in calibration source&#39;</span>

    <span class="c1"># Drop unnecessary variables from the Dataset</span>
    <span class="n">xr_dataset</span> <span class="o">=</span> <span class="n">xr_dataset</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="s1">&#39;recno&#39;</span><span class="p">,</span> <span class="s1">&#39;kindat&#39;</span><span class="p">,</span> <span class="s1">&#39;kinst&#39;</span><span class="p">,</span> <span class="s1">&#39;dgdalt&#39;</span><span class="p">,</span> <span class="s1">&#39;drlel&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">xr_dataset</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_time_dimension</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert separate time-related components into a single datetime64 array.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    year (np.ndarray): Array of year values.</span>
<span class="sd">    month (np.ndarray): Array of month values.</span>
<span class="sd">    day (np.ndarray): Array of day values.</span>
<span class="sd">    hour (np.ndarray): Array of hour values.</span>
<span class="sd">    minute (np.ndarray): Array of minute values.</span>
<span class="sd">    second (np.ndarray): Array of second values.</span>

<span class="sd">    Returns:</span>
<span class="sd">    np.ndarray: A numpy array of datetime64[ns] values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure all inputs are appropriately formatted and zero-padded</span>
    <span class="n">datetime_strings</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">T</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">y</span><span class="p">,</span> <span class="n">mo</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># Convert the list of date-time strings to a numpy array with dtype &#39;datetime64[ns]&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">datetime_strings</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">DopplerReference</span><span class="p">(</span><span class="n">xr_array</span><span class="p">,</span> <span class="n">vertical_mask</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="s1">&#39;laser&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate and add Doppler reference values to an xarray dataset based on a specified reference method.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    xr_array (xarray.Dataset): The input dataset containing Doppler velocity (&#39;vnu&#39;) and error (&#39;dvnu&#39;) data.</span>
<span class="sd">    vertical_mask (xarray.DataArray): A mask array to identify vertical Doppler values.</span>
<span class="sd">    reference (str): The reference method to use (&#39;laser&#39; or &#39;zenith&#39;). Defaults to &#39;laser&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">    xarray.Dataset: The input dataset with added Doppler reference values (&#39;ref_Dop&#39;) and their uncertainties (&#39;e_ref_Dop&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Mask vertical values and drop NaNs</span>
    <span class="n">clean_vertical_values</span> <span class="o">=</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vertical_mask</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">clean_vertical_errors</span> <span class="o">=</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">dvnu</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vertical_mask</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

    <span class="c1"># Process based on the requested Doppler reference</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;zenith&#39;</span><span class="p">:</span>
        <span class="c1"># Interpolate the zenith Doppler values</span>
        <span class="n">ref_Dop</span> <span class="o">=</span> <span class="n">clean_vertical_values</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">e_ref_Dop</span> <span class="o">=</span> <span class="n">clean_vertical_errors</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;laser&#39;</span><span class="p">:</span>
        <span class="c1"># Use the mode statistic by finding value which minimizes Lp-norm of residual, for small p</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># m/s, desired resolution</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># norm</span>

        <span class="c1"># Find minimum weighted norm Doppler reference</span>
        <span class="n">mxz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">clean_vertical_values</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">mnz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">clean_vertical_values</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mxz</span> <span class="o">&lt;</span> <span class="n">mnz</span><span class="p">:</span>
            <span class="c1"># There aren&#39;t many samples. Just use actual min/max</span>
            <span class="n">mxz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">clean_vertical_values</span><span class="p">)</span>
            <span class="n">mnz</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">clean_vertical_values</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">mxz</span> <span class="o">-</span> <span class="n">mnz</span><span class="p">)</span> <span class="o">/</span> <span class="n">res</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mf">1e6</span><span class="p">:</span>
            <span class="c1"># This is probably low-quality data, return the median value instead</span>
            <span class="n">ref_Dop</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">clean_vertical_values</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">})</span>
            <span class="n">e_ref_Dop</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">clean_vertical_errors</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mnz</span><span class="p">,</span> <span class="n">mxz</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">dtest</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

                <span class="c1"># Doppler reference</span>
                <span class="n">zcorr</span> <span class="o">=</span> <span class="n">clean_vertical_values</span> <span class="o">-</span> <span class="n">d</span>

                <span class="c1"># Evaluate metric</span>
                <span class="n">cost</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">zcorr</span> <span class="o">/</span> <span class="n">clean_vertical_errors</span><span class="p">)</span> <span class="o">**</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">jstar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">dtest</span><span class="p">[</span><span class="n">jstar</span><span class="p">]</span>
            <span class="n">ref_Dop</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">offset</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">})</span>
            <span class="n">e_ref_Dop</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">offset</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">})</span>

    <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;ref_Dop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_Dop</span>
    <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;e_ref_Dop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_ref_Dop</span>

    <span class="k">return</span> <span class="n">xr_array</span>

<span class="k">def</span><span class="w"> </span><span class="nf">los_2_horizontal</span><span class="p">(</span><span class="n">xr_array</span><span class="p">,</span> <span class="n">los_mask</span><span class="p">,</span> <span class="n">vertical_mask</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert line-of-sight Doppler velocities to horizontal velocities in specified directions.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    xr_array (xarray.Dataset): The input dataset containing Doppler velocity (&#39;vnu&#39;), error (&#39;dvnu&#39;), Doppler reference (&#39;ref_Dop&#39;), and elevation angle (&#39;elm&#39;) data.</span>
<span class="sd">    los_mask (xarray.DataArray): A mask array to identify line-of-sight Doppler values.</span>
<span class="sd">    vertical_mask (xarray.DataArray): A mask array to identify vertical Doppler values.</span>
<span class="sd">    direction (str): The direction for horizontal conversion (&#39;east&#39;, &#39;west&#39;, &#39;north&#39;, &#39;south&#39;, or &#39;zenith&#39;).</span>

<span class="sd">    Returns:</span>
<span class="sd">    xarray.Dataset: The input dataset with added horizontal velocity components (&#39;u&#39;, &#39;v&#39;, &#39;w&#39;) and their uncertainties (&#39;ue&#39;, &#39;ve&#39;, &#39;we&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Identify time samples in the line of sight (los) direction</span>
    <span class="n">time_samples_los</span> <span class="o">=</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">los_mask</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Identify the los values (removing the Doppler reference), uncertainties, and elevation angles</span>
    <span class="n">clean_los_values</span> <span class="o">=</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">los_mask</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">ref_Dop</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">los_mask</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">clean_los_errors</span> <span class="o">=</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">dvnu</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">los_mask</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">clean_elm</span> <span class="o">=</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">elm</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">los_mask</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

    <span class="c1"># Identify vertical values (removing the Doppler reference) and uncertainties</span>
    <span class="n">clean_vertical_values</span> <span class="o">=</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vertical_mask</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">ref_Dop</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vertical_mask</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">clean_vertical_errors</span> <span class="o">=</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">dvnu</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vertical_mask</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

    <span class="c1"># Interpolate vertical values onto the time samples in the los direction</span>
    <span class="n">interpolated_vertical</span> <span class="o">=</span> <span class="n">clean_vertical_values</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time_samples_los</span><span class="p">)</span>
    <span class="n">interpolated_vertical_errors</span> <span class="o">=</span> <span class="n">clean_vertical_errors</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time_samples_los</span><span class="p">)</span>

    <span class="c1"># Run the math</span>
    <span class="n">horizontal</span> <span class="o">=</span> <span class="p">(</span><span class="n">clean_los_values</span> <span class="o">-</span> <span class="n">interpolated_vertical</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">clean_elm</span><span class="p">)))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">clean_elm</span><span class="p">))</span>
    <span class="n">horizontal_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">clean_los_errors</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">interpolated_vertical_errors</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">clean_elm</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">clean_elm</span><span class="p">))</span>

    <span class="c1"># Align the coordinates before assignment</span>
    <span class="n">horizontal</span> <span class="o">=</span> <span class="n">horizontal</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
    <span class="n">horizontal_e</span> <span class="o">=</span> <span class="n">horizontal_e</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;west&#39;</span><span class="p">]:</span>
        <span class="c1"># Initialize the &#39;u&#39; variable in the xr_array if it does not exist</span>
        <span class="k">if</span> <span class="s1">&#39;u&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xr_array</span><span class="p">:</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">})</span>
        <span class="k">if</span> <span class="s1">&#39;ue&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xr_array</span><span class="p">:</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;ue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">})</span>

        <span class="c1"># Assign the calculated values to the &#39;u&#39; variable at the correct time indices</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;east&#39;</span><span class="p">:</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">los_mask</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">horizontal</span><span class="p">)</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;ue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;ue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">los_mask</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">horizontal_e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">los_mask</span><span class="p">,</span> <span class="n">other</span><span class="o">=-</span><span class="n">horizontal</span><span class="p">)</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;ue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;ue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">los_mask</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">horizontal_e</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;south&#39;</span><span class="p">]:</span>
        <span class="c1"># Initialize the &#39;v&#39; variable in the xr_array if it does not exist</span>
        <span class="k">if</span> <span class="s1">&#39;v&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xr_array</span><span class="p">:</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">})</span>
        <span class="k">if</span> <span class="s1">&#39;ve&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xr_array</span><span class="p">:</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;ve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">})</span>

        <span class="c1"># Assign the calculated values to the &#39;v&#39; variable at the correct time indices</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;north&#39;</span><span class="p">:</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">los_mask</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">horizontal</span><span class="p">)</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;ve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;ve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">los_mask</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">horizontal_e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">los_mask</span><span class="p">,</span> <span class="n">other</span><span class="o">=-</span><span class="n">horizontal</span><span class="p">)</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;ve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;ve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">los_mask</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">horizontal_e</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;zenith&#39;</span><span class="p">:</span>
        <span class="n">this_w</span> <span class="o">=</span> <span class="n">interpolated_vertical</span>
        <span class="n">this_e</span> <span class="o">=</span> <span class="n">interpolated_vertical_errors</span>

        <span class="c1"># Align coordinates before assignment</span>
        <span class="n">this_w</span> <span class="o">=</span> <span class="n">this_w</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">this_e</span> <span class="o">=</span> <span class="n">this_e</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

        <span class="c1"># Initialize the &#39;w&#39; variable in the xr_array if it does not exist</span>
        <span class="k">if</span> <span class="s1">&#39;w&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xr_array</span><span class="p">:</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">})</span>
        <span class="k">if</span> <span class="s1">&#39;we&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xr_array</span><span class="p">:</span>
            <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;we&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">xr_array</span><span class="o">.</span><span class="n">vnu</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">xr_array</span><span class="o">.</span><span class="n">time</span><span class="p">})</span>

        <span class="c1"># Assign the calculated values to the &#39;w&#39; variable at the correct time indices</span>
        <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">los_mask</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">this_w</span><span class="p">)</span>
        <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;we&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr_array</span><span class="p">[</span><span class="s1">&#39;we&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">los_mask</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">this_e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xr_array</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-the-hdf5-file-downloaded-from-madrigal">
<h3>Load the HDF5 file downloaded from Madrigal<a class="headerlink" href="#load-the-hdf5-file-downloaded-from-madrigal" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># f = os.path.join(asi_directory, &#39;minime11_low_20230510_xg.cedar.034.hdf5&#39;)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">asi_directory</span><span class="p">,</span> <span class="s1">&#39;minime11_low_20230510_xg.cedar.042.hdf5&#39;</span><span class="p">)</span>

<span class="c1"># Open the HDF5 file</span>
<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
    <span class="c1"># Access the dataset from the HDF5 file</span>
    <span class="n">table_layout</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s1">&#39;Data/Table Layout&#39;</span><span class="p">]</span>
    
    <span class="c1"># Read the data</span>
    <span class="n">table_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">table_layout</span><span class="p">)</span>
    
    <span class="c1"># Convert to xarray Dataset</span>
    <span class="n">xr_dataset</span> <span class="o">=</span> <span class="n">mangofpi_to_xarray</span><span class="p">(</span><span class="n">table_array</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-the-look-directions-and-convert-from-line-of-sight-to-horizontal-winds">
<h3>Define the look directions and convert from line-of-sight to horizontal winds<a class="headerlink" href="#define-the-look-directions-and-convert-from-line-of-sight-to-horizontal-winds" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define el/az coords for each direction and create masks</span>
<span class="n">east</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">elm</span> <span class="o">==</span> <span class="mf">45.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">azm</span> <span class="o">==</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">west</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">elm</span> <span class="o">==</span> <span class="mf">45.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">azm</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span><span class="p">)</span>
<span class="n">north</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">elm</span> <span class="o">==</span> <span class="mf">45.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">azm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">south</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">elm</span> <span class="o">==</span> <span class="mf">45.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">azm</span> <span class="o">==</span> <span class="mi">180</span><span class="p">)</span>
<span class="n">vertical</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">elm</span> <span class="o">==</span> <span class="mf">90.</span><span class="p">)</span>

<span class="c1"># Set the Doppler reference</span>
<span class="n">xr_dataset</span> <span class="o">=</span> <span class="n">DopplerReference</span><span class="p">(</span><span class="n">xr_dataset</span><span class="p">,</span><span class="n">vertical</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="s1">&#39;zenith&#39;</span><span class="p">)</span>

<span class="c1"># Convert to horizontal winds (u, v, w)</span>
<span class="n">xr_dataset</span> <span class="o">=</span> <span class="n">los_2_horizontal</span><span class="p">(</span><span class="n">xr_dataset</span><span class="p">,</span><span class="n">east</span><span class="p">,</span><span class="n">vertical</span><span class="p">,</span><span class="s1">&#39;east&#39;</span><span class="p">)</span>
<span class="n">xr_dataset</span> <span class="o">=</span> <span class="n">los_2_horizontal</span><span class="p">(</span><span class="n">xr_dataset</span><span class="p">,</span><span class="n">west</span><span class="p">,</span><span class="n">vertical</span><span class="p">,</span><span class="s1">&#39;west&#39;</span><span class="p">)</span>
<span class="n">xr_dataset</span> <span class="o">=</span> <span class="n">los_2_horizontal</span><span class="p">(</span><span class="n">xr_dataset</span><span class="p">,</span><span class="n">north</span><span class="p">,</span><span class="n">vertical</span><span class="p">,</span><span class="s1">&#39;north&#39;</span><span class="p">)</span>
<span class="n">xr_dataset</span> <span class="o">=</span> <span class="n">los_2_horizontal</span><span class="p">(</span><span class="n">xr_dataset</span><span class="p">,</span><span class="n">south</span><span class="p">,</span><span class="n">vertical</span><span class="p">,</span><span class="s1">&#39;south&#39;</span><span class="p">)</span>
<span class="n">xr_dataset</span> <span class="o">=</span> <span class="n">los_2_horizontal</span><span class="p">(</span><span class="n">xr_dataset</span><span class="p">,</span><span class="n">vertical</span><span class="p">,</span><span class="n">vertical</span><span class="p">,</span><span class="s1">&#39;zenith&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-a-plot-of-the-horizontal-winds">
<h3>Create a plot of the horizontal winds<a class="headerlink" href="#create-a-plot-of-the-horizontal-winds" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.dates</span><span class="w"> </span><span class="kn">import</span> <span class="n">DateFormatter</span>

<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">east</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">east</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">yerr</span><span class="o">=</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">ue</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">east</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;yo-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">west</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">west</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">yerr</span><span class="o">=</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">ue</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">west</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;mo-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">north</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">north</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">yerr</span><span class="o">=</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">ve</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">north</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;ro-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">south</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">south</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">yerr</span><span class="o">=</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">ve</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">south</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;go-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">yerr</span><span class="o">=</span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">we</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;ko-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">])</span>

<span class="c1"># Format the x-axis to display only the hour</span>
<span class="n">date_formatter</span> <span class="o">=</span> <span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">date_formatter</span><span class="p">)</span>
<span class="n">time_values</span> <span class="o">=</span> <span class="n">xr_dataset</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span>

<span class="c1">## Generate a human-readable date range for the title</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">time_values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">time_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;UT Hour&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Neutral Wind [m/s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6ac4c707b1b8fbb662313159587f2509aa64f2dea06b5048075592e91575ec3b.png" src="../_images/6ac4c707b1b8fbb662313159587f2509aa64f2dea06b5048075592e91575ec3b.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./src"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="markdown.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Markdown Files</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#helper-functions">Helper Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-information-about-the-dataset-to-be-worked-on">Setup information about the dataset to be worked on</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-data-and-load-in-the-hdf5-file">Download data and load in the HDF5 file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-the-loaded-dataset">Examine the loaded dataset</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manipulate-data">Manipulate data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#you-can-easily-create-masks-to-remove-low-elevation-obstructions">You can easily create masks to remove low-elevation obstructions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#you-can-plot-the-average-intensity-over-time-of-the-high-elevation-angle-pixels">You can plot the average intensity over time of the high-elevation angle pixels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#you-can-create-sub-images">You can create sub-images</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#you-can-temporally-filter-the-data">You can temporally filter the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-can-now-display-the-filtered-data-or-a-subset-in-various-coordinates">We can now display the filtered data, or a subset, in various coordinates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#can-load-another-site-and-plot-both-imagers-on-a-map">Can load another site and plot both imagers on a map</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fpi-data">FPI Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#can-load-in-fpi-data-and-plot-it">Can load in FPI data and plot it</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-some-helper-functions-needed-to-work-with-fpi-data">Define some helper functions needed to work with FPI data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-hdf5-file-downloaded-from-madrigal">Load the HDF5 file downloaded from Madrigal</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-look-directions-and-convert-from-line-of-sight-to-horizontal-winds">Define the look directions and convert from line-of-sight to horizontal winds</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-plot-of-the-horizontal-winds">Create a plot of the horizontal winds</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By A. Bhatt, J. Makela, B. Harding, L. Lamarche
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>